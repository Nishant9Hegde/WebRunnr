<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'unsafe-inline' 'unsafe-eval'; connect-src 'none';">
</head>
<body>
  <script>
    let stdout = '';
    let stderr = '';
    
    // Capture console outputs
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;
    const originalInfo = console.info;
    const originalDebug = console.debug;
    
    function formatArgs(args) {
      return args.map(arg => {
        if (typeof arg === 'object') {
          try {
            return JSON.stringify(arg, null, 2);
          } catch (e) {
            return String(arg);
          }
        }
        return String(arg);
      }).join(' ');
    }
    
    console.log = (...args) => {
      stdout += formatArgs(args) + '\n';
      originalLog.apply(console, args);
    };
    
    console.info = (...args) => {
      stdout += formatArgs(args) + '\n';
      originalInfo.apply(console, args);
    };
    
    console.debug = (...args) => {
      stdout += formatArgs(args) + '\n';
      originalDebug.apply(console, args);
    };
    
    console.error = (...args) => {
      stderr += formatArgs(args) + '\n';
      originalError.apply(console, args);
    };
    
    console.warn = (...args) => {
      stderr += '[WARN] ' + formatArgs(args) + '\n';
      originalWarn.apply(console, args);
    };
    
    function executeCode(code) {
      // Reset outputs for each execution
      stdout = '';
      stderr = '';
      
      try {
        // Execute the code
        const result = eval(code);
        
        // If the result is not undefined, add it to stdout
        if (result !== undefined) {
          stdout += String(result) + '\n';
        }
        
      } catch (error) {
        // Capture error details
        let errorMessage = error.message;
        if (error.stack) {
          errorMessage += '\n' + error.stack;
        }
        stderr += errorMessage + '\n';
      }
      
      // Send results back to parent
      window.parent.postMessage({
        type: 'EXECUTION_RESULT',
        stdout: stdout.trim(),
        stderr: stderr.trim()
      }, '*');
    }
    
    // Listen for execution requests
    window.addEventListener('message', (event) => {
      if (event.data.type === 'EXECUTE_CODE') {
        executeCode(event.data.code);
      }
    });
  </script>
</body>
</html>